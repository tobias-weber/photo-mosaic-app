<button class="btn btn-secondary mb-3" routerLink="../../">Back</button>


@let j = job();
@if (j) {
    <h1>{{ j.startedAt | date:'short' }}</h1>

    @if (!isComplete()) {
        <div class="position-relative d-flex justify-content-center preview-container">
            @if (hasPreview()) {
                <img [src]="mosaic()?.url" class="mosaic-img rounded" alt="Mosaic Preview">
            } @else if (targetImage()) {
                <img [src]="targetImage()?.url" class="mosaic-img rounded" alt="Target">
            }
            <div class="position-absolute top-50 start-50 translate-middle">
                <button class="btn btn-light btn-lg d-flex flex-column status-button" type="button" disabled>
                    <div class="d-flex align-items-center">
                        <span class="spinner-border" aria-hidden="true"></span>
                        <span role="status" class="ms-3">{{ statusText() }}</span>
                    </div>
                    @if (j.status === JobStatus.Processing) {
                        <div style="min-width: 300px">
                            <ngb-progressbar class="mt-3" type="primary" [value]="j.progress * 100" [striped]="true"/>
                        </div>
                    }
                </button>
            </div>
        </div>

    }

    @if (j.status === JobStatus.Finished) {
        <div class="mb-5">
            <app-mosaic-viewer [jobId]="j.jobId"></app-mosaic-viewer>
        </div>

        <h3 class="text-center">Target Image</h3>
        <div class="d-flex justify-content-center preview-container mb-3">
            <img [src]="targetImage()?.url" class="full-width-img" alt="Target">
        </div>
    } @else if (j.status === JobStatus.Failed) {
        <div class="alert alert-danger" role="alert">
            The mosaic creation has failed. Please try again.
        </div>
    }

    <div class="col-6 col-lg-4 mb-5">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">{{ JobStatus[j.status] }}</h5>
                <p class="card-text">Number of Tiles: {{ j.n }}</p>
                <p class="card-text">Subdivisions: {{ j.subdivisions }}</p>
                <p class="card-text">Repetitions: {{ j.repetitions }}</p>
                <p class="card-text">Crop Count: {{ j.cropCount }}</p>

                @if (isComplete()) {
                    <p class="card-text">Finished: {{ j.finishedAt | date:'short' }}</p>
                }
            </div>
        </div>
    </div>
}
