<input
    #fileInput
    type="file"
    [multiple]="multiple()"
    [accept]="allowedFileTypes"
    [disabled]="disabled()"
    (change)="onFileSelected($event)"
    hidden
>

@if (!hasFiles()) {
    <div
        class="drop-zone p-5 text-center border-dashed rounded-3 bg-body-tertiary"
        (click)="onZoneClicked()"
    >
        <div class="zone-content">
            @if (multiple()) {
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="text-primary" viewBox="0 0 16 16">
                    <path d="M4.502 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"/>
                    <path d="M14.002 13a2 2 0 0 1-2 2h-10a2 2 0 0 1-2-2V5A2 2 0 0 1 2 3a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8a2 2 0 0 1-1.998 2M14 2H4a1 1 0 0 0-1 1h9.002a2 2 0 0 1 2 2v7A1 1 0 0 0 15 11V3a1 1 0 0 0-1-1M2.002 4a1 1 0 0 0-1 1v8l2.646-2.354a.5.5 0 0 1 .63-.062l2.66 1.773 3.71-3.71a.5.5 0 0 1 .577-.094l1.777 1.947V5a1 1 0 0 0-1-1z"/>
                </svg>
            } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="text-primary" viewBox="0 0 16 16">
                    <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
                    <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"/>
                </svg>
            }
            <p class="mt-3 mb-0 text-muted fs-2">
                <strong>Drag and drop or <span class="text-primary">browse</span></strong>
            </p>
        </div>
    </div>
    <p class="mt-1">
        @if (multiple()) {
            Select up to {{maxFiles}} images to upload.
        } @else {
            Select an image to upload.
        }
    </p>
} @else {
    <div class="preview-container">
        <div class="preview-header d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-2">
                @if (multiple()) {
                    Selected Images ({{ files().length }})
                } @else {
                    Selected Image
                }
            </h5>
            @if (!disabled() && multiple()) {
                <button class="btn btn-sm btn-danger d-flex align-items-center gap-1" (click)="clearFiles()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
                    </svg> Clear All
                </button>
            }
        </div>

        @if (showPreviews()) {
            <div class="row g-3">
                @for (item of files(); track item.file.name) {
                    <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                        <div class="card h-100 shadow-sm preview-item">
                            <img
                                [src]="item.previewUrl"
                                [alt]="item.file.name"
                                class="card-img-top preview-img"
                            >
                            <div class="card-body p-2">
                                <p class="card-text small text-truncate mb-0" [title]="item.file.name">
                                    {{ item.file.name }}
                                </p>
                                <p class="card-text text-muted small">
                                    {{ (item.file.size / 1024 / 1024).toFixed(2) }} MB
                                </p>
                            </div>
                            @if (!disabled()) {
                                <button
                                    class="btn-close"
                                    (click)="removeFile(item)"
                                ></button>
                            }
                        </div>
                    </div>
                }
            </div>
        } @else {
            <ul class="list-group">
                @for (item of files(); track item.file.name) {
                    <li class="list-group-item d-flex justify-content-between">
                        <div>
                            <span class="small text-truncate" [title]="item.file.name">
                                {{ item.file.name }}
                                <span class="text-muted ms-3">
                                    ({{ (item.file.size / 1024 / 1024).toFixed(2) }} MB)
                                </span>
                            </span>
                        </div>
                        @if (!disabled()) {
                            <button
                                class="btn-close"
                                (click)="removeFile(item)"
                            ></button>
                        }
                    </li>
                }
            </ul>
        }
    </div>
}
